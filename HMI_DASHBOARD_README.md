# ESS AI System - HMI Dashboard (Stage 9)

## 개요

Streamlit 기반의 사용자 친화적인 HMI(Human Machine Interface) 대시보드입니다.
운전자가 시스템 상태를 직관적으로 파악하고 제어할 수 있습니다.

## 주요 기능

### 1. 메인 대시보드 (1초 자동 새로고침)
- 실시간 센서 모니터링 (T5, T6, PX1, 엔진 부하)
- 온도 트렌드 그래프 (최근 10분)
- 에너지 절감률 게이지
- 장비 운전 상태 다이어그램

### 2. 그룹별 제어 패널
각 장비 그룹(SW 펌프, FW 펌프, E/R 팬)은 독립적으로 제어 모드를 선택할 수 있습니다:

- ○ **60Hz 고정**: 모든 운전 중인 장비를 60Hz 고정 주파수로 운전
- ● **AI 제어**: AI가 계산한 최적 주파수로 자동 제어

**중요**: 제어 명령은 **운전 중인 장비에만 적용**되며, Stand-by 장비는 영향을 받지 않습니다.

### 3. 목표 vs 실제 주파수 모니터링

입력 조건 → AI 계산 → 목표 주파수 → 실제 반영 전체 흐름을 실시간으로 모니터링합니다.

**편차 상태 분류**:
- 🟢 **Green**: 편차 < 0.3Hz (정상)
- 🟡 **Yellow**: 0.3Hz ≤ 편차 < 0.5Hz (주의)
- 🔴 **Red**: 편차 ≥ 0.5Hz (경고)

💡 **참고**: ±0.3Hz 이내 편차는 VFD 및 모터의 기계적 특성으로 정상 범위입니다.

### 4. 긴급 정지 기능

- **점진적 전환**: 30초에 걸쳐 현재 주파수에서 60Hz로 점진적으로 증가
- **자동 모드 전환**: 완료 시 모든 그룹이 자동으로 "60Hz 고정" 모드로 전환
- **알람 발생**: CRITICAL 우선순위 알람 자동 생성

### 5. 알람 관리

**우선순위별 색상**:
- 🔴 **CRITICAL (Red)**: VFD Trip, 긴급 정지, 시스템 오류
- 🟡 **WARNING (Yellow)**: 주파수 편차 초과, 센서 이상
- 🔵 **INFO (Blue)**: 학습 완료, 모드 전환, 일반 정보

**기능**:
- 우선순위 필터링
- 알람 확인 (Acknowledge)
- 시간순 정렬

### 6. 운전 시간 균등화 모니터링

**추적 항목**:
- **총 운전 시간**: 장비별 누적 운전 시간
- **금일 운전 시간**: 당일 00:00부터의 운전 시간
- **연속 운전 시간**: 마지막 기동부터의 연속 운전 시간

**자동 교체 주기**:
- **펌프**: 24시간마다 자동 교체
- **팬**: 6시간마다 자동 교체

**수동 개입**:
- 특정 장비를 강제 운전/대기/자동 모드로 설정 가능

### 7. 학습 진행 추적

**주요 지표**:
- 온도 예측 정확도
- 최적화 정확도
- 평균 에너지 절감률
- 총 학습 시간

**AI 진화 단계** (3단계):
1. **Stage 1 (0-6개월)**: 규칙 기반 (규칙 80% + ML 20%)
2. **Stage 2 (6-12개월)**: 패턴 학습 (규칙 70% + ML 30%)
3. **Stage 3 (12개월+)**: 적응형 (규칙 60% + ML 40%)

## 실행 방법

### 1. 필요한 패키지 설치

```bash
pip install -r requirements.txt
```

주요 패키지:
- `streamlit>=1.25.0`: Web-based dashboard
- `plotly>=5.14.0`: Interactive charts

### 2. 대시보드 실행

#### Windows:
```bash
run_dashboard.bat
```

#### Linux/Mac:
```bash
streamlit run src/hmi/dashboard.py --server.port 8501
```

### 3. 브라우저 접속

대시보드가 시작되면 자동으로 브라우저가 열립니다.
또는 수동으로 다음 주소로 접속:

```
http://localhost:8501
```

## 화면 구성

### 탭 1: 📊 메인 대시보드
- 실시간 센서 값 (T5, T6, PX1, 엔진 부하)
- 온도 트렌드 그래프 (10분)
- 에너지 절감률 게이지
- 장비 운전 상태 다이어그램

### 탭 2: 🎛️ 제어 패널
- 그룹별 제어 모드 선택 (60Hz 고정 / AI 제어)
- 목표 vs 실제 주파수 비교 테이블
- 편차 상태 모니터링 (Green/Yellow/Red)

### 탭 3: 📈 성능 모니터링
- 에너지 절감률 추이 (1시간)
- 운전 시간 균등화 모니터링
- 수동 개입 옵션

### 탭 4: 🔔 알람 관리
- 우선순위별 알람 리스트 (CRITICAL/WARNING/INFO)
- 알람 확인 기능
- 알람 통계

### 탭 5: 📚 학습 진행
- 주요 학습 지표 (온도 예측, 최적화, 에너지 절감)
- 주간 개선 추이 그래프
- AI 진화 단계 진행 상황

## 사이드바

- **현재 시간**: 실시간 시계
- **긴급 정지 버튼**: 🛑 긴급 정지 / ▶️ 긴급 정지 해제
- **활성 알람 개수**: 우선순위별 미확인 알람 통계

## 실시간 데이터 연동

실제 운영 환경에서는 다음 모듈과 연동합니다:

```python
from src.data.data_collector import DataCollector
from src.control.integrated_controller import IntegratedController
from src.equipment.equipment_manager import EquipmentManager
from src.ml.predictive_controller import PredictiveController
```

현재 대시보드는 **시뮬레이션 데이터**를 사용하여 독립적으로 동작합니다.
실제 시스템 연동 시 해당 부분을 실제 데이터로 교체하면 됩니다.

## 성능

- **새로고침 주기**: 1초 (실시간 모니터링)
- **온도 트렌드**: 최근 10분 (600 데이터 포인트)
- **에너지 추이**: 최근 1시간 (3600 데이터 포인트)
- **메모리 사용량**: 약 50MB (Streamlit + Plotly)

## 테스트

```bash
python tests/test_stage9.py
```

**테스트 항목** (7개):
1. ✅ 그룹별 제어 모드 전환
2. ✅ 목표 vs 실제 주파수 모니터링
3. ✅ 긴급 정지 (30초 점진적 전환)
4. ✅ 알람 관리 (CRITICAL/WARNING/INFO)
5. ✅ 운전 시간 균등화 모니터링
6. ✅ 학습 진행 추적
7. ✅ 상태 내보내기 (로깅/분석)

## 주요 파일

```
src/hmi/
├── __init__.py                 # HMI 모듈 초기화
├── hmi_state_manager.py        # HMI 상태 관리자
│   ├── HMIStateManager         # 상태 관리 클래스
│   ├── ControlMode             # 제어 모드 (60Hz 고정 / AI 제어)
│   ├── AlarmPriority           # 알람 우선순위
│   ├── EmergencyStopState      # 긴급 정지 상태
│   ├── EquipmentGroup          # 장비 그룹
│   └── Alarm                   # 알람 정보
└── dashboard.py                # Streamlit 대시보드
    └── Dashboard               # 대시보드 클래스
```

## 향후 개선 사항

1. **사용자 인증**: 로그인 시스템 추가
2. **데이터 내보내기**: CSV/Excel 내보내기 기능
3. **알람 이메일 알림**: CRITICAL 알람 발생 시 자동 이메일 발송
4. **모바일 반응형**: 모바일 기기 최적화
5. **다국어 지원**: 영어/한국어 전환
6. **설정 저장**: 사용자별 설정 저장/불러오기

## 문의

ESS AI 시스템 - Stage 9 HMI Dashboard
HMM 16K급 선박 에너지 절감 시스템
NVIDIA Jetson Xavier NX 기반
