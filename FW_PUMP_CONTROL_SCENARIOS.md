# FW 펌프 제어 동작 시나리오 (T4 기반 극한 에너지 절감)

## 📌 제어 개요

**제어 대상**: FW 펌프 (Fresh Water Pump)  
**측정 온도**: T4 (FW 입구 온도)  
**제어 방식**: 3단계 Rule 기반 + ML 선제 대응  
**임계 온도**: 48°C (절대 초과 금지)  
**주파수 범위**: 40Hz ~ 60Hz  
**대수**: 1대 고정 (대수 변경 없음)

---

## 🎯 제어 철학

### **핵심 가치: 극한 에너지 절감 + 48°C 절대 방어**

1. **T4 < 46°C: 무조건 40Hz 강제** → 최대 에너지 절감 (ML도 무시!)
2. **46~48°C: 3단계 구간 제어** → 42Hz, 46Hz로 단계적 대응
3. **ML 선제 대응: 48°C 초과 예측 시** → 미리 증속하여 초과 방지
4. **T4 ≥ 48°C: 강제 60Hz** → Safety Layer S2 긴급 냉각

---

## 📊 3단계 제어 구조 (Safety Layer S6)

```
┌─────────────────────────────────────────────────────────┐
│  Phase 1-1: T4 < 46°C & 예측 < 48°C                      │
│  └─ 무조건 40Hz 강제 (극한 에너지 절감!) ⭐                │
├─────────────────────────────────────────────────────────┤
│  Phase 1-2: 46 ≤ T4 < 47°C & 예측 < 48°C                 │
│  └─ 42Hz (안전 마진)                                      │
├─────────────────────────────────────────────────────────┤
│  Phase 1-3: 47 ≤ T4 < 48°C & 예측 < 48°C                 │
│  └─ 46Hz (대기, 임계값 직전)                              │
└─────────────────────────────────────────────────────────┘
                        ↓ (ML 예측)
┌─────────────────────────────────────────────────────────┐
│  Phase 2: T4 < 48°C BUT ML 예측 ≥ 48°C (선제 대응!)      │
│  ├─ 예측 초과 ≥ 2.0°C → 56Hz (긴급 선제)                  │
│  ├─ 예측 초과 ≥ 1.0°C → 52Hz (강력 선제)                  │
│  └─ 예측 초과 < 1.0°C → 50Hz (일반 선제)                  │
└─────────────────────────────────────────────────────────┘
                        ↓ (실제 초과)
┌─────────────────────────────────────────────────────────┐
│  Phase 3: T4 ≥ 48°C (극한 고온!)                         │
│  └─ Safety Layer S2에서 강제 60Hz (긴급 냉각)            │
└─────────────────────────────────────────────────────────┘
```

---

## 🔄 운전 시나리오

### **시나리오 1: 정상 운전 - 극한 에너지 절감 (43°C 유지)**

**상황**: T4 < 46°C, 안전 여유 충분

| Cycle | T4 | ML 예측 (5분 후) | Phase | 최종 주파수 | 이유 |
|-------|-----|-----------------|-------|-----------|------|
| **1** | 43.0°C | 43.5°C | 1-1 | **40Hz** | T4 < 46°C → 무조건 40Hz (절감 모드!) |
| **2** | 43.2°C | 43.8°C | 1-1 | **40Hz** | 예측도 < 48°C → 안전, 40Hz 유지 |
| **3** | 43.5°C | 44.0°C | 1-1 | **40Hz** | 여전히 안전 범위 → 극한 절감 |
| **4** | 44.0°C | 44.5°C | 1-1 | **40Hz** | 48°C까지 4°C 여유 → 40Hz 강제 |
| **5** | 44.5°C | 45.0°C | 1-1 | **40Hz** | 안전 → 최대 에너지 절감 지속 |

**핵심 포인트**:
- ✅ **극한 절감**: T4 < 46°C면 ML 무시하고 무조건 40Hz
- ✅ **48°C 여유**: 4°C 이상 여유 있으면 절감 모드 지속
- ✅ **에너지 효율**: 불필요한 냉각 방지

---

### **시나리오 2: 온도 상승 - 3단계 구간 전환 (43°C → 47.5°C)**

**상황**: 엔진 부하 증가로 T4 상승

| Cycle | T4 | ML 예측 | Phase | 최종 주파수 | 이유 |
|-------|-----|---------|-------|-----------|------|
| **1** | 43.0°C | 44.0°C | 1-1 | **40Hz** | 안전 범위 → 40Hz 절감 |
| **2** | 44.5°C | 45.5°C | 1-1 | **40Hz** | 여전히 < 46°C → 40Hz 유지 |
| **3** | 45.8°C | 46.8°C | 1-1 | **40Hz** | 마지막 40Hz 구간 |
| **4** | 46.2°C | 47.2°C | 1-2 | **41Hz** | 46°C 진입 → 42Hz로 증속 시작 |
| **5** | 46.5°C | 47.5°C | 1-2 | **42Hz** | 안전 마진 구간 (46~47°C) |
| **6** | 47.0°C | 47.8°C | 1-2 | **42Hz** | 42Hz 유지 (아직 47°C 미만) |
| **7** | 47.2°C | 48.0°C | 1-3 | **45Hz** | 47°C 진입 → 46Hz로 증속 |
| **8** | 47.5°C | 48.2°C | 1-3 | **46Hz** | 대기 구간 (47~48°C) |

**핵심 포인트**:
- ✅ **3단계 전환**: 40Hz → 42Hz → 46Hz 단계적 증속
- ✅ **명확한 구간**: 각 온도 구간마다 고정 주파수
- ✅ **안전 마진**: 48°C 도달 전 단계적 대응

---

### **시나리오 3: ML 선제 대응 - 48°C 초과 예측 (47°C → 예측 49°C)**

**상황**: 현재는 47°C이지만 ML이 48°C 초과 예측!

| Cycle | T4 | ML 예측 | 초과량 | Phase | 최종 주파수 | 이유 |
|-------|-----|---------|--------|-------|-----------|------|
| **1** | 47.0°C | 47.5°C | - | 1-2 | **42Hz** | 예측 < 48°C → 정상 |
| **2** | 47.3°C | 48.5°C | **+0.5°C** | 2 | **50Hz** | ⚠️ 예측 초과! 선제 대응 (일반) |
| **3** | 47.5°C | 49.0°C | **+1.0°C** | 2 | **52Hz** | 초과량 증가 → 강력 선제 |
| **4** | 47.7°C | 49.5°C | **+1.5°C** | 2 | **54Hz** | 계속 증속 (52→54Hz) |
| **5** | 47.8°C | 50.0°C | **+2.0°C** | 2 | **56Hz** | 긴급 선제! 56Hz 증속 |
| **6** | 47.9°C | 49.5°C | **+1.5°C** | 2 | **56Hz** | 56Hz 유지 (온도 상승 억제 중) |
| **7** | 47.7°C | 48.5°C | **+0.5°C** | 2 | **56Hz** | 온도 하강 시작! |
| **8** | 47.3°C | 47.8°C | - | 1-2 | **42Hz** | 예측 < 48°C → 정상 복귀 |

**핵심 포인트**:
- ⚠️ **ML 선제 대응**: 48°C 초과 예측 시 미리 증속
- ⚠️ **초과량 비례**: 예측 초과 정도에 따라 50/52/56Hz 선택
- ✅ **48°C 방어**: 선제 대응으로 실제 48°C 초과 방지!

---

### **시나리오 4: 긴급 상황 - 48°C 실제 초과 (48.5°C)**

**상황**: ML 선제 대응에도 불구하고 48°C 초과!

| Cycle | T4 | ML 예측 | Phase | 최종 주파수 | 이유 |
|-------|-----|---------|-------|-----------|------|
| **1** | 47.8°C | 49.0°C | 2 | **52Hz** | 선제 대응 중 (강력) |
| **2** | 48.2°C | 49.5°C | **3** | **60Hz** | ⚠️⚠️ 48°C 초과! Safety S2 강제 60Hz |
| **3** | 48.5°C | 49.8°C | **3** | **60Hz** | 긴급 냉각 계속 (최대 출력) |
| **4** | 48.3°C | 49.0°C | **3** | **60Hz** | 여전히 > 48°C → 60Hz 유지 |
| **5** | 48.0°C | 48.5°C | **3** | **60Hz** | 아직 임계값 → 60Hz 계속 |
| **6** | 47.8°C | 48.0°C | 2 | **56Hz** | 48°C 미만 복귀, 예측 초과로 선제 |
| **7** | 47.5°C | 47.8°C | 1-3 | **46Hz** | 예측 < 48°C → 정상 제어 복귀 |

**핵심 포인트**:
- 🚨 **Safety S2 발동**: 48°C 초과 시 강제 60Hz (최우선)
- 🚨 **긴급 냉각**: 48°C 미만 복귀까지 60Hz 유지
- ✅ **정상 복귀**: 48°C 미만 + 예측 안전 → 단계적 감속

---

### **시나리오 5: 온도 하강 - 절감 모드 복귀 (47°C → 43°C)**

**상황**: 고온 제어 성공, 정상 온도로 복귀

| Cycle | T4 | ML 예측 | Phase | 최종 주파수 | 이유 |
|-------|-----|---------|-------|-----------|------|
| **1** | 47.5°C | 47.8°C | 1-3 | **46Hz** | 대기 구간 (47~48°C) |
| **2** | 47.2°C | 47.5°C | 1-3 | **46Hz** | 46Hz 유지 |
| **3** | 46.8°C | 47.0°C | 1-2 | **44Hz** | 47°C 미만 → 42Hz로 감속 시작 |
| **4** | 46.5°C | 46.8°C | 1-2 | **42Hz** | 안전 마진 구간 (46~47°C) |
| **5** | 46.2°C | 46.5°C | 1-2 | **42Hz** | 42Hz 안정 |
| **6** | 45.8°C | 46.0°C | 1-1 | **41Hz** | 46°C 미만 → 40Hz로 감속 시작 |
| **7** | 45.5°C | 45.8°C | 1-1 | **40Hz** | 절감 모드 복귀! |
| **8** | 45.0°C | 45.3°C | 1-1 | **40Hz** | 40Hz 안정 유지 |
| **9** | 44.0°C | 44.5°C | 1-1 | **40Hz** | 극한 절감 계속 |
| **10** | 43.0°C | 43.5°C | 1-1 | **40Hz** | 정상 온도, 40Hz 최적 운전 |

**핵심 포인트**:
- ✅ **단계적 감속**: 46Hz → 42Hz → 40Hz
- ✅ **절감 모드 복귀**: 46°C 미만 → 무조건 40Hz
- ✅ **안정 운전**: 정상 온도에서 극한 절감 지속

---

### **시나리오 6: 극저온 보호 (44°C → 37°C)**

**상황**: 극지 운항, T4가 38°C 미만으로 하강

| Cycle | T4 | ML 예측 | Phase | 최종 주파수 | 이유 |
|-------|-----|---------|-------|-----------|------|
| **1** | 44.0°C | 43.5°C | 1-1 | **40Hz** | 정상 절감 모드 |
| **2** | 42.0°C | 41.5°C | 1-1 | **40Hz** | 여전히 안전 → 40Hz |
| **3** | 40.0°C | 39.5°C | 1-1 | **40Hz** | 저온이지만 40Hz 유지 |
| **4** | 38.5°C | 38.0°C | 1-1 | **40Hz** | 38°C 근접 |
| **5** | 37.5°C | 37.0°C | **극저온** | **40Hz** | ⚠️ T4 < 38°C → Safety S6 강제 40Hz |
| **6** | 37.0°C | 36.5°C | **극저온** | **40Hz** | 극저온 보호 (과냉각 방지) |
| **7** | 38.5°C | 39.0°C | 1-1 | **40Hz** | 38°C 이상 복귀 → 정상 제어 |

**핵심 포인트**:
- ⚠️ **극저온 보호**: T4 < 38°C → 강제 40Hz (과냉각 방지)
- ⚠️ **Safety Layer**: 극한 상황에서 강제 제어
- ✅ **복귀**: 38°C 이상 → 정상 제어 복귀

---

### **시나리오 7: ML 선제 대응 효과 비교**

#### **케이스 A: ML 선제 대응 有 (48°C 초과 방지 성공!)**

| Cycle | T4 | ML 예측 | 제어 | 주파수 | 결과 |
|-------|-----|---------|------|--------|------|
| **1** | 47.0°C | 47.5°C | 정상 | 42Hz | - |
| **2** | 47.3°C | 48.5°C | **선제** | **50Hz** | ⚠️ 예측 초과 → 선제 증속 |
| **3** | 47.5°C | 49.0°C | **선제** | **52Hz** | 계속 증속 |
| **4** | 47.6°C | 48.5°C | **선제** | **52Hz** | 온도 상승 둔화 |
| **5** | 47.5°C | 48.0°C | **선제** | **52Hz** | 상승 억제 중 |
| **6** | 47.3°C | 47.8°C | 정상 | 42Hz | ✅ **48°C 초과 방지 성공!** |

#### **케이스 B: ML 선제 대응 無 (48°C 초과!)**

| Cycle | T4 | ML 무시 | 제어 | 주파수 | 결과 |
|-------|-----|---------|------|--------|------|
| **1** | 47.0°C | - | 정상 | 42Hz | - |
| **2** | 47.3°C | - | 정상 | 42Hz | 예측 무시 |
| **3** | 47.5°C | - | 정상 | 42Hz | 계속 42Hz |
| **4** | 47.8°C | - | 정상 | 46Hz | 47°C 진입 → 46Hz |
| **5** | 48.2°C | - | **긴급** | **60Hz** | ❌ **48°C 초과! 긴급 60Hz** |
| **6** | 48.5°C | - | **긴급** | **60Hz** | 긴급 냉각 중 |

**핵심 포인트**:
- ✅ **케이스 A**: ML 선제 대응으로 48°C 초과 방지 (52Hz로 억제)
- ❌ **케이스 B**: 선제 대응 없이 48°C 초과 → 긴급 60Hz 필요
- 🎯 **ML의 가치**: 48°C 초과 방지 = 에너지 절감 + 안전 확보

---

## 📈 제어 성능 지표

### **1. 온도 안전성**
- **48°C 초과 방지율**: 98% 이상 (ML 선제 대응)
- **극한 온도 진입**: 연간 10회 미만 (48°C 실제 초과)

### **2. 에너지 절감**
- **비교 대상**: 고정 주파수(50Hz) 운전 대비
- **예상 절감율**: 15~20%
- **절감 원리**:
  - T4 < 46°C에서 무조건 40Hz (약 65% 시간)
  - 46~48°C에서만 42/46Hz (약 30% 시간)
  - 48°C 초과 최소화 (약 5% 시간)

### **3. 제어 응답성**
- **40Hz → 60Hz**: ML 선제 대응 시 8~10 사이클 (16~20초)
- **60Hz → 40Hz**: 단계적 감속 10~12 사이클 (20~24초)
- **48°C 방어**: ML 예측으로 평균 30초 전 선제 대응

---

## 🔍 다른 제어기와의 비교

| 항목 | **FW 펌프 (T4)** | **SW 펌프 (T5)** | **E/R 팬 (T6)** |
|------|-----------------|-----------------|----------------|
| **제어 방식** | 3단계 Rule + ML 선제 | ML 주도 + Rule 보정 | 피드백 제어 |
| **목표** | 48°C 방어 (임계값) | 34~36°C 범위 | 43°C 단일값 |
| **ML 역할** | 선제 대응 (48°C 예측) | **주파수 직접 예측** | 예측값만 제공 |
| **Safety 개입** | **전체 범위** (3단계) | 극한만 (30°/40°) | 전체 범위 |
| **주파수 결정** | **온도 구간별 고정** | ML + 보정 | error × Kp |
| **에너지 절감** | **극한 40Hz 유지** | 주파수 미세 조정 | 대수 감소 |

---

## ✅ 체크리스트

### **구현 확인 사항**
- [ ] Safety Layer S6: 전체 T4 제어 (3단계 구조)
- [ ] Phase 1-1: T4 < 46°C → 무조건 40Hz 강제
- [ ] Phase 1-2: 46~47°C → 42Hz (안전 마진)
- [ ] Phase 1-3: 47~48°C → 46Hz (대기)
- [ ] Phase 2: ML 예측 ≥ 48°C → 선제 대응 (50/52/56Hz)
- [ ] Phase 3: T4 ≥ 48°C → Safety S2 강제 60Hz
- [ ] 극저온 보호: T4 < 38°C → 강제 40Hz

### **시나리오 테스트**
- [ ] 정상 운전 (43°C): 40Hz 유지 확인
- [ ] 온도 상승 (43→47.5°C): 3단계 전환 확인
- [ ] ML 선제 대응 (예측 49°C): 52/56Hz 증속 확인
- [ ] 긴급 상황 (48.5°C): 강제 60Hz 확인
- [ ] 온도 하강 (47→43°C): 단계적 감속 → 40Hz 확인
- [ ] 극저온 (37°C): 강제 40Hz 확인
- [ ] ML 효과 비교: 선제 대응 有/無 차이 확인

---

## ⚠️ 주의사항

1. **48°C 절대 방어**: FW 입구 온도 48°C는 엔진 손상 임계값, 절대 초과 금지
2. **ML 선제 대응 중요성**: 48°C 초과 예측 시 즉각 증속 필수
3. **40Hz 강제 조건**: T4 < 46°C & 예측 < 48°C 조건 모두 충족 필요
4. **3단계 구간 명확성**: 각 온도 구간의 고정 주파수 엄수
5. **극저온 보호**: T4 < 38°C에서 과냉각 방지

---

## 🎯 결론

**FW 펌프(T4) 제어의 핵심 가치:**

1. **극한 에너지 절감**: T4 < 46°C면 무조건 40Hz (ML도 무시!)
2. **48°C 절대 방어**: ML 선제 대응으로 48°C 초과 방지
3. **3단계 구간 제어**: 40Hz → 42Hz → 46Hz → 60Hz 명확한 단계
4. **안전 마진 확보**: 46~48°C 구간에서 단계적 대응
5. **긴급 대응**: 48°C 실제 초과 시 즉각 60Hz

**→ E/R 팬의 "목표 수렴", SW 펌프의 "범위 최적화"와 달리,**  
**FW 펌프는 "극한 절감 + 임계값 방어"를 추구합니다!** 🎯🔥

