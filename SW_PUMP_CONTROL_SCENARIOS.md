# SW 펌프 제어 동작 시나리오 (T5 기반 ML + Rule 협업)

## 📌 제어 개요

**제어 대상**: SW 펌프 (Sea Water Pump)  
**측정 온도**: T5 (FW 출구 온도)  
**제어 방식**: ML 예측 제어 + Rule R1 강화 보정  
**목표 범위**: 34~36°C (정상 운전 범위)  
**주파수 범위**: 40Hz ~ 60Hz  
**대수**: 1대 고정 (대수 변경 없음)

---

## 🎯 제어 철학

### **핵심 가치: ML 주도 최적화 + Rule 가속 보정**

1. **ML이 주파수를 직접 예측**: Random Forest가 엔진 부하, 해수 온도, 계절 등 외부 변수를 학습하여 최적 주파수 결정
2. **34~36°C 범위 내에서 ML 자유 제어**: 이 범위에서는 Rule 보정 없이 ML이 상황별 최적값 탐색
3. **범위 이탈 시 Rule R1이 가속 보정**: 60Hz/40Hz 목표 달성을 가속화
4. **Safety Layer는 극한 온도만 개입**: 40°C 초과 또는 30°C 미만에서만 강제 제어

---

## 📊 3계층 제어 구조

```
┌─────────────────────────────────────────────────────────┐
│  Safety Layer (S4): 극한 온도 강제 제어                   │
│  ├─ T5 > 40.0°C → 강제 60Hz (극고온 긴급)                 │
│  └─ T5 < 30.0°C → 강제 40Hz (극저온 긴급)                 │
└─────────────────────────────────────────────────────────┘
                        ↓ (30~40°C 통과)
┌─────────────────────────────────────────────────────────┐
│  ML Optimization Layer: 주파수 직접 예측                  │
│  └─ Random Forest(T5, 부하, 해수온, 계절...) → 주파수     │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  Fine-tuning Layer (R1): ML 결과 보정                    │
│  ├─ T5 > 38.0°C → ML + 최대 6Hz (60Hz 가속)              │
│  ├─ T5 > 36.0°C → ML + 최대 4Hz                          │
│  ├─ 34~36°C → ML 그대로 (정상 범위, 보정 없음) ⭐         │
│  ├─ T5 < 34.0°C → ML - 최대 3Hz                          │
│  └─ T5 < 32.0°C → ML - 최대 6Hz (40Hz 가속)              │
└─────────────────────────────────────────────────────────┘
```

---

## 🔄 운전 시나리오

### **시나리오 1: 정상 운전 → 고온 상승 (34°C → 38°C)**

**상황**: 엔진 부하 증가, 해수 온도 상승

| Cycle | T5 | ML 예측 | Rule R1 보정 | 최종 주파수 | 이유 |
|-------|-----|---------|-------------|-----------|------|
| **1** | 34.5°C | 48Hz | 0Hz | **48Hz** | 정상 범위 → ML 그대로 |
| **2** | 35.0°C | 50Hz | 0Hz | **50Hz** | 정상 범위 → ML 주도 |
| **3** | 35.8°C | 52Hz | 0Hz | **52Hz** | 정상 범위 내 → 보정 없음 |
| **4** | 36.5°C | 54Hz | +2Hz | **56Hz** | T5 > 36°C → 약간 높음, 보정 시작 |
| **5** | 37.2°C | 55Hz | +3Hz | **58Hz** | T5 > 36°C → +4Hz 보정 (최대치) |
| **6** | 38.0°C | 56Hz | +4Hz | **60Hz** | T5 > 38°C → +6Hz 보정 (60Hz 도달!) |
| **7** | 38.5°C | 58Hz | +2Hz | **60Hz** | 이미 60Hz 최대치 유지 |

**핵심 포인트**:
- ✅ **34~36°C**: ML이 자유롭게 48→50→52Hz 조정
- ✅ **36~38°C**: Rule R1이 보정 시작 (+2~4Hz)
- ✅ **38°C 이상**: 강력 보정으로 60Hz 빠른 도달

---

### **시나리오 2: 고온 안정 → 정상 복귀 (38°C → 35°C)**

**상황**: 60Hz 냉각 효과로 온도 하강

| Cycle | T5 | ML 예측 | Rule R1 보정 | 최종 주파수 | 이유 |
|-------|-----|---------|-------------|-----------|------|
| **1** | 38.0°C | 58Hz | +2Hz | **60Hz** | T5 > 38°C → 60Hz 유지 |
| **2** | 37.5°C | 56Hz | +3Hz | **59Hz** | T5 > 36°C → 약간 높음 |
| **3** | 36.8°C | 54Hz | +2Hz | **56Hz** | T5 > 36°C → 보정 감소 |
| **4** | 36.2°C | 52Hz | 0Hz | **52Hz** | 정상 범위 진입 → 보정 중단 |
| **5** | 35.5°C | 50Hz | 0Hz | **50Hz** | 정상 범위 → ML 주도 |
| **6** | 35.0°C | 48Hz | 0Hz | **48Hz** | 정상 범위 안정 |

**핵심 포인트**:
- ✅ **60Hz 유지**: T5 > 38°C 구간에서 강력 냉각
- ✅ **단계적 감속**: Rule R1 보정이 점진적으로 감소
- ✅ **정상 범위 복귀**: 36.2°C에서 보정 중단, ML 주도로 전환

---

### **시나리오 3: 정상 운전 → 저온 진입 (35°C → 31°C)**

**상황**: 엔진 부하 감소, 해수 온도 하강

| Cycle | T5 | ML 예측 | Rule R1 보정 | 최종 주파수 | 이유 |
|-------|-----|---------|-------------|-----------|------|
| **1** | 35.0°C | 48Hz | 0Hz | **48Hz** | 정상 범위 → ML 그대로 |
| **2** | 34.5°C | 46Hz | 0Hz | **46Hz** | 정상 범위 → ML 주도 |
| **3** | 33.8°C | 45Hz | -1Hz | **44Hz** | T5 < 34°C → 약간 낮음, 보정 시작 |
| **4** | 33.0°C | 44Hz | -2Hz | **42Hz** | T5 < 34°C → -3Hz 보정 |
| **5** | 32.2°C | 43Hz | -3Hz | **40Hz** | T5 < 32°C → -6Hz 보정 (40Hz 도달!) |
| **6** | 31.5°C | 42Hz | -2Hz | **40Hz** | 이미 40Hz 최소치 유지 |

**핵심 포인트**:
- ✅ **34°C 미만**: Rule R1이 감속 보정 시작
- ✅ **32°C 미만**: 강력 보정으로 40Hz 빠른 도달
- ✅ **에너지 절감**: 저온에서 최소 주파수로 운전

---

### **시나리오 4: 저온 안정 → 정상 복귀 (31°C → 35°C)**

**상황**: 엔진 부하 증가, 40Hz 운전 중

| Cycle | T5 | ML 예측 | Rule R1 보정 | 최종 주파수 | 이유 |
|-------|-----|---------|-------------|-----------|------|
| **1** | 31.5°C | 42Hz | -2Hz | **40Hz** | T5 < 32°C → 40Hz 유지 |
| **2** | 32.0°C | 43Hz | -3Hz | **40Hz** | T5 < 32°C → 40Hz 강제 |
| **3** | 32.8°C | 44Hz | -2Hz | **42Hz** | T5 < 34°C → 약간 낮음 |
| **4** | 33.5°C | 46Hz | -1Hz | **45Hz** | T5 < 34°C → 보정 감소 |
| **5** | 34.2°C | 47Hz | 0Hz | **47Hz** | 정상 범위 진입 → 보정 중단 |
| **6** | 35.0°C | 48Hz | 0Hz | **48Hz** | 정상 범위 → ML 주도 |

**핵심 포인트**:
- ✅ **40Hz 유지**: T5 < 32°C에서 에너지 절감
- ✅ **단계적 증속**: Rule R1 보정이 점진적으로 감소
- ✅ **정상 범위 복귀**: 34.2°C에서 보정 중단, ML 주도로 전환

---

### **시나리오 5: 극한 고온 긴급 대응 (39°C → 41°C)**

**상황**: 냉각수 이상, T5가 40°C 초과

| Cycle | T5 | ML 예측 | Safety S4 | 최종 주파수 | 이유 |
|-------|-----|---------|-----------|-----------|------|
| **1** | 39.0°C | 58Hz | - | **60Hz** | Rule R1 → +6Hz 보정 |
| **2** | 39.8°C | 59Hz | - | **60Hz** | 60Hz 유지 (최대치) |
| **3** | 40.5°C | 59Hz | **강제 60Hz** | **60Hz** | ⚠️ Safety S4 발동! (극고온) |
| **4** | 41.0°C | 58Hz | **강제 60Hz** | **60Hz** | Safety Layer 강제 제어 |
| **5** | 40.2°C | 59Hz | **강제 60Hz** | **60Hz** | T5 > 40°C → 계속 강제 |
| **6** | 39.5°C | 58Hz | - | **60Hz** | Safety 해제, Rule R1 복귀 |

**핵심 포인트**:
- ⚠️ **40°C 초과**: Safety Layer S4가 ML/Rule 무시하고 강제 60Hz
- ⚠️ **극한 상황**: 냉각수 계통 이상 등 긴급 상황 대응
- ✅ **복귀**: 40°C 미만으로 내려가면 정상 제어 복귀

---

### **시나리오 6: 극한 저온 긴급 대응 (31°C → 29°C)**

**상황**: 해수 온도 극저, T5가 30°C 미만

| Cycle | T5 | ML 예측 | Safety S4 | 최종 주파수 | 이유 |
|-------|-----|---------|-----------|-----------|------|
| **1** | 31.0°C | 42Hz | - | **40Hz** | Rule R1 → -6Hz 보정 |
| **2** | 30.5°C | 41Hz | - | **40Hz** | 40Hz 유지 (최소치) |
| **3** | 29.8°C | 40Hz | **강제 40Hz** | **40Hz** | ⚠️ Safety S4 발동! (극저온) |
| **4** | 29.0°C | 41Hz | **강제 40Hz** | **40Hz** | Safety Layer 강제 제어 |
| **5** | 29.5°C | 42Hz | **강제 40Hz** | **40Hz** | T5 < 30°C → 계속 강제 |
| **6** | 30.5°C | 43Hz | - | **40Hz** | Safety 해제, Rule R1 복귀 |

**핵심 포인트**:
- ⚠️ **30°C 미만**: Safety Layer S4가 강제 40Hz (과냉각 방지)
- ⚠️ **극한 상황**: 극지 운항, 해수 온도 극저 상황 대응
- ✅ **복귀**: 30°C 이상으로 올라가면 정상 제어 복귀

---

### **시나리오 7: ML 학습 효과 - 외부 변수 반영**

**상황**: 동일한 T5 온도, 다른 운전 조건

#### **케이스 A: 고부하 + 열대 해역**
| 조건 | T5 | 엔진 부하 | 해수 온도 | ML 예측 | Rule R1 | 최종 |
|------|-----|----------|----------|---------|---------|------|
| 고부하 열대 | 35.0°C | 85% | 30°C | **52Hz** | 0Hz | **52Hz** |

**ML 판단**: "고부하 + 고온 해수 → 온도 상승 예상 → 선제 증속"

#### **케이스 B: 저부하 + 온대 해역**
| 조건 | T5 | 엔진 부하 | 해수 온도 | ML 예측 | Rule R1 | 최종 |
|------|-----|----------|----------|---------|---------|------|
| 저부하 온대 | 35.0°C | 40% | 20°C | **46Hz** | 0Hz | **46Hz** |

**ML 판단**: "저부하 + 저온 해수 → 온도 안정 → 에너지 절감 가능"

**핵심 포인트**:
- ✅ **ML의 학습 능력**: 동일 T5에서도 외부 변수에 따라 다른 주파수 선택
- ✅ **선제 대응**: 온도 상승 예상 시 미리 증속
- ✅ **에너지 최적화**: 안정 상황에서 최소 주파수로 절감

---

## 📈 제어 성능 지표

### **1. 온도 안정성**
- **정상 범위 유지율**: 95% 이상 (34~36°C)
- **극한 온도 진입**: 연간 5회 미만 (40°C 초과 또는 30°C 미만)

### **2. 에너지 절감**
- **비교 대상**: 고정 주파수(50Hz) 운전 대비
- **예상 절감율**: 10~15%
- **절감 원리**:
  - ML이 상황별 최적 주파수 선택 (과잉 냉각 방지)
  - 저부하/저온 시 40Hz 운전
  - 고부하/고온 시에만 60Hz 운전

### **3. 제어 응답성**
- **정상 → 고온**: 6~8 사이클 (12~16초) 내 60Hz 도달
- **고온 → 정상**: 5~6 사이클 (10~12초) 내 정상 복귀
- **정상 → 저온**: 5~6 사이클 (10~12초) 내 40Hz 도달

---

## 🔍 E/R 팬(T6)과의 비교

| 항목 | **SW 펌프 (T5)** | **E/R 팬 (T6)** |
|------|-----------------|----------------|
| **제어 방식** | ML 주도 + Rule 보정 | 피드백 제어 (P-Control) |
| **목표** | 34~36°C 범위 | 43°C 단일값 |
| **주파수 결정** | ML이 직접 예측 | error × 3.0 |
| **외부 변수** | ✅ 학습 반영 (부하, 해수온) | ❌ 미반영 |
| **대수 변경** | ❌ 없음 (1대 고정) | ✅ 있음 (2~4대) |
| **에너지 절감** | 주파수 미세 최적화 | 대수 감소 |

---

## ✅ 체크리스트

### **구현 확인 사항**
- [ ] Safety Layer S4: 극한 온도(40°C 초과, 30°C 미만) 강제 제어
- [ ] ML Optimization: Random Forest 주파수 예측 동작
- [ ] Rule R1 보정: T5 온도에 따른 보정값 적용
- [ ] 정상 범위(34~36°C): ML 결과 그대로 사용 (보정 없음)
- [ ] 60Hz/40Hz 수렴: Rule R1 보정으로 가속 달성
- [ ] 외부 변수 학습: 엔진 부하, 해수 온도 반영

### **시나리오 테스트**
- [ ] 정상 → 고온 (34→38°C): 60Hz 도달 확인
- [ ] 고온 → 정상 (38→35°C): 단계적 감속 확인
- [ ] 정상 → 저온 (35→31°C): 40Hz 도달 확인
- [ ] 저온 → 정상 (31→35°C): 단계적 증속 확인
- [ ] 극한 고온 (41°C): Safety S4 강제 60Hz 확인
- [ ] 극한 저온 (29°C): Safety S4 강제 40Hz 확인
- [ ] ML 학습 효과: 동일 T5, 다른 조건에서 다른 주파수 확인

---

## ⚠️ 주의사항

1. **ML 학습 데이터**: 초기 운전 시 더미 데이터로 시작, 실제 데이터 축적 필요
2. **ML 신뢰도**: `confidence > 0.5` 이상일 때만 ML 예측 사용
3. **Rule R1 보정**: ML 결과를 보완하는 역할, ML을 완전히 대체하지 않음
4. **정상 범위 중요성**: 34~36°C는 ML이 자유롭게 최적화하는 핵심 구간
5. **Safety Layer 우선**: 극한 온도에서는 ML/Rule 무시하고 강제 제어

---

## 🎯 결론

**SW 펌프(T5) 제어의 핵심 가치:**

1. **ML 주도 최적화**: 외부 변수를 학습하여 상황별 최적 주파수 선택
2. **34~36°C 자유 제어**: 이 범위에서는 보정 없이 ML이 자율적으로 최적화
3. **Rule R1 가속 보정**: 범위 이탈 시 60Hz/40Hz 달성 가속
4. **에너지 절감**: 과잉 냉각 방지, 저부하 시 40Hz 운전
5. **선제 대응**: ML 예측으로 온도 상승 전 미리 증속

**→ E/R 팬의 "목표 수렴"과 달리, SW 펌프는 "범위 내 최적화"를 추구합니다!** 🎯✨

