# 온도 예측 제어 로직 상세 설명

## 시스템 구조 이해

### 냉각 시스템 흐름
```
┌─────────────────────────────────────────────────────────┐
│                    Main Engine                          │
│                   (열 발생원)                            │
└────────────┬────────────────────────────┬────────────────┘
             │                            │
             │ FW (Fresh Water)           │ E/R 공기
             │                            │
      ┌──────▼──────┐              ┌─────▼──────┐
      │   T4 (FW    │              │  T6 (E/R   │
      │   Inlet)    │              │   Temp)    │
      └──────┬──────┘              └─────┬──────┘
             │                            │
    ┌────────▼────────┐                  │
    │    Cooler       │            ┌─────▼──────┐
    │  (열교환기)      │            │  E/R Fans  │
    │                 │            │  (환기)     │
    │  SW ──────►     │            └────────────┘
    │  (냉각수)        │
    └────────┬────────┘
             │
      ┌──────▼──────┐
      │   T5 (FW    │
      │   Outlet)   │
      └─────────────┘
```

### 온도 센서 위치와 의미
| 센서 | 위치 | 의미 |
|------|------|------|
| **T1** | SW Inlet | 해수 유입 온도 (환경 조건) |
| **T2, T3** | SW Outlet | Cooler 출구 해수 (과열 감지) |
| **T4** | FW Inlet | 엔진에서 나온 고온 냉각수 |
| **T5** | FW Outlet | Cooler에서 냉각된 냉각수 |
| **T6** | E/R | 기관실 공기 온도 |
| **T7** | Outside Air | 외기 온도 (환경 조건) |

---

## 온도별 제어 로직

### 1. T4 (FW Inlet) 제어

#### 온도 의미:
- 엔진에서 배출되는 **고온 냉각수**
- 목표: **< 48°C** (긴급 임계)

#### 제어 방법:
```python
if T4 상승 예상:
    → FW 펌프 증속
    → FW 순환 속도 증가
    → Cooler 통과 횟수 증가
    → T4 하강
```

#### 예측 제어:
- **+1.0°C 이상 예상**: FW 펌프 **+3Hz**
- **+0.5°C ~ 1.0°C 예상**: FW 펌프 **+2Hz**

#### 이유:
- T4는 엔진 열부하 직접 반영
- FW 순환 빠르게 → 엔진 냉각 효율 증가

---

### 2. T5 (FW Outlet) 제어 ✅ **핵심!**

#### 온도 의미:
- Cooler에서 **냉각된 후** 엔진으로 돌아가는 냉각수
- 목표: **35±0.5°C**

#### 제어 방법:
```python
if T5 상승 예상:
    → SW 펌프 증속  ✅ (여기가 핵심!)
    → Cooler에 해수 더 많이 공급
    → Cooler 냉각 능력 증가
    → T5 하강
```

#### 예측 제어:
- **+0.5°C 이상 예상**: SW 펌프 **+3Hz**
- **+0.3°C ~ 0.5°C 예상**: SW 펌프 **+2Hz**

#### 왜 SW 펌프인가? (질문 주신 부분)
**T5는 FW Outlet이지만:**
1. T5 = Cooler 출구 온도
2. T5를 낮추려면 = **Cooler 냉각 능력 증가** 필요
3. Cooler 냉각 능력 = **해수(SW) 공급량**에 비례
4. 따라서 **SW 펌프 증속**이 정답! ✅

**FW 펌프는 왜 안 되나?**
- FW 펌프 = FW 순환만 담당
- Cooler 냉각 능력 자체는 변화 없음
- 순환만 빨라져도 온도는 크게 안 떨어짐

---

### 3. T6 (E/R Temperature) 제어

#### 온도 의미:
- **기관실 공기** 온도
- 목표: **43±1.0°C**

#### 제어 방법:
```python
if T6 상승 예상:
    → E/R 팬 증속
    → 기관실 환기 증가
    → 뜨거운 공기 배출
    → T6 하강
```

#### 예측 제어:
- **+1.0°C 이상 예상**: E/R 팬 **+4Hz**
- **+0.5°C ~ 1.0°C 예상**: E/R 팬 **+2Hz**

#### 이유:
- T6는 공기 온도
- 펌프는 영향 없음
- 오직 **환기(팬)**만 효과적

---

## 증속량이 다른 이유

### Hz 설정 근거:

| 온도 | 임계값 | 증속량 | 이유 |
|------|--------|--------|------|
| **T4** | +1.0°C | +3Hz | FW 순환 빠르게, 엔진 직접 냉각 |
| **T4** | +0.5°C | +2Hz | 중간 수준 대응 |
| **T5** | +0.5°C | +3Hz | Cooler 냉각 능력 증가 (민감) |
| **T5** | +0.3°C | +2Hz | T5 목표가 엄격 (±0.5°C) |
| **T6** | +1.0°C | +4Hz | 공기 냉각은 반응 느림, 강하게 |
| **T6** | +0.5°C | +2Hz | 중간 수준 대응 |

### 왜 다른가?

1. **T5 민감도 높음**
   - 목표: 35±**0.5°C** (가장 엄격)
   - 0.3°C만 예상되어도 대응 (+2Hz)
   - 0.5°C 예상 시 강하게 대응 (+3Hz)

2. **T6는 느리지만 중요**
   - 공기는 물보다 열용량 작음 → 반응 느림
   - 상승 예상 시 **강하게 증속 필요** (+4Hz)
   - 기관실 과열 방지 중요

3. **T4는 엔진 직결**
   - 임계값 48°C (여유 있음)
   - 1도 상승까지는 중간 대응 (+3Hz)

---

## 예측 제어 예시

### 시나리오 1: 엔진 부하 증가 예상

**예측 결과:**
- T4: 현재 45.0°C → 10분 후 46.2°C (+1.2°C)
- T5: 현재 35.0°C → 10분 후 35.6°C (+0.6°C)
- T6: 현재 43.0°C → 10분 후 44.3°C (+1.3°C)

**제어 결정:**
```
✅ T4 +1.2°C 예상 → FW 펌프 +3Hz
✅ T5 +0.6°C 예상 → SW 펌프 +3Hz
✅ T6 +1.3°C 예상 → E/R 팬 +4Hz

최종: 
  SW 펌프: 48Hz → 51Hz (+3Hz)
  FW 펌프: 48Hz → 51Hz (+3Hz)
  E/R 팬:  48Hz → 52Hz (+4Hz)
```

---

### 시나리오 2: T5만 상승 예상 (Cooler 효율 저하)

**예측 결과:**
- T4: 현재 45.0°C → 10분 후 45.1°C (+0.1°C)
- T5: 현재 35.0°C → 10분 후 35.7°C (+0.7°C) ⚠️
- T6: 현재 43.0°C → 10분 후 43.2°C (+0.2°C)

**제어 결정:**
```
✅ T5 +0.7°C 예상 → SW 펌프 +3Hz (Cooler 냉각 강화!)

최종: 
  SW 펌프: 48Hz → 51Hz (+3Hz) ✅
  FW 펌프: 48Hz (변화 없음)
  E/R 팬:  48Hz (변화 없음)
```

**이것이 핵심!** T5 상승 → SW 펌프만 증속 → Cooler 냉각 능력 향상

---

### 시나리오 3: 정박 (전체 하강 예상)

**예측 결과:**
- T4: 현재 45.0°C → 10분 후 44.0°C (-1.0°C)
- T5: 현재 35.0°C → 10분 후 34.5°C (-0.5°C)
- T6: 현재 43.0°C → 10분 후 41.8°C (-1.2°C)

**제어 결정:**
```
✅ 모든 온도 하강 예상 → 증속 없음
✅ PID 제어로 점진적 감속 허용

최종: 
  SW 펌프: 48Hz → 46Hz (PID 감속)
  FW 펌프: 48Hz → 46Hz (PID 감속)
  E/R 팬:  48Hz → 44Hz (PID 감속)

→ 에너지 절감 극대화!
```

---

## 요약

### 핵심 원리:
1. **T4 (FW Inlet)** → **FW 펌프** (엔진 냉각수 순환)
2. **T5 (FW Outlet)** → **SW 펌프** (Cooler 냉각 능력) ✅
3. **T6 (E/R Temp)** → **E/R 팬** (기관실 환기)

### 각 장비가 **독립적으로** 제어됨:
- T4만 상승 → FW 펌프만 증속
- T5만 상승 → SW 펌프만 증속
- T6만 상승 → E/R 팬만 증속
- 복합 상승 → 각각 독립적으로 증속

### 증속량이 다른 이유:
- 온도 **민감도** 차이 (T5 > T6 > T4)
- 장비 **응답 특성** 차이 (공기 vs 물)
- **안전 여유도** 차이 (임계값까지 거리)

### 선제적 제어 효과:
- 10분 전 미리 증속 → 긴급 60Hz 방지
- 각 장비 최소한만 증속 → 에너지 절감
- 온도 변동폭 감소 → 시스템 안정성

---

**이제 완전히 정확한 로직입니다!** 감사합니다! 🎉

